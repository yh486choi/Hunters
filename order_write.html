<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ì˜¤ë” ì‘ì„±</title>

<link rel="stylesheet" href="buttonStyles.css" />

<style>
  body {
    font-size: 16px;
    font-family: Arial, sans-serif;
    padding: 20px;
  }

  /* ---------------------------------------------------
      TOP AREA (ì˜¤ë”ëª… ì…ë ¥ + ì €ì¥ë²„íŠ¼)
  --------------------------------------------------- */
  #topArea {
    margin-bottom: 20px;
    text-align: center;
  }

  /* ---------------------------------------------------
      MAIN AREA (A-B-C 3ë‹¨ ë ˆì´ì•„ì›ƒ)
  --------------------------------------------------- */
  #mainArea {
    display: flex;
    gap: 20px;
    align-items: flex-start; /* ìƒë‹¨ ë®ì–´ì“°ê¸° */
  }

  /* ---------------------------------------------------
      A AREA â€” ì°¸ê°€ ì„ ìˆ˜ ëª…ë‹¨
  --------------------------------------------------- */
  #areaA {
    width: 200px;
    padding: 10px;
    border: 1px solid #aaa;
    border-radius: 8px;
  }

  #playerSelect {
    width: 110px;
    padding: 4px;
  }

  table {
    border-collapse: collapse;
    width: 200px;
    margin-top: 8px;
  }

  th, td {
    border: 1px solid #999;
    padding: 6px;
    text-align: center;
  }
  th { background: #bae4ff; }

  /* ---------------------------------------------------
      B AREA â€” í¬ì§€ì…˜ ì§€ì • + ì¶œì „ ê°€ëŠ¥í•œ í¬ì§€ì…˜ ë¦¬ìŠ¤íŠ¸
  --------------------------------------------------- */
  #areaB {
    width: 500px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  /* B1 â€” í¬ì§€ì…˜ ì§€ì • (field.png) */
  #areaB1 {
    width: 500px;
    height: 400px;
    background-image: url("field.png");
    background-size: contain;
    background-repeat: no-repeat;
    position: relative;
    border: 1px solid #ccc;
    border-radius: 8px;
    flex-shrink: 0;
  }

  .posSelect {
    position: absolute;
    width: 70px;
    padding: 3px;
    font-size: 14px;
    border-radius: 8px;
  }

  /* í¬ì§€ì…˜ ì¢Œí‘œ (ì„ì‹œê°’ - ì¡°ì • ê°€ëŠ¥) */
  #pos_CF { top: 15%; left: 50%; transform: translateX(-50%); }
  #pos_LF { top: 25%; left: 18%; }
  #pos_RF { top: 25%; right: 18%; }

  #pos_SS { top: 47%; left: 30%; }
  #pos_2B { top: 47%; right: 30%; }

  #pos_3B { top: 63%; left: 20%; }
  #pos_1B { top: 63%; right: 20%; }

  #pos_P  { top: 63%; left: 50%; transform: translateX(-50%); }
  #pos_C  { top: 80%; left: 50%; transform: translateX(-50%); }

  #pos_DH { top: 85%; right: 13%; }

  /* B2 â€” ì¶œì „ ê°€ëŠ¥ í¬ì§€ì…˜ ë¦¬ìŠ¤íŠ¸ (ì§€ê¸ˆì€ ë¹„ì›Œë‘ ) */
  #areaB2 {
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 10px;
  }

  /* ---------------------------------------------------
      C AREA â€” ì„ ë°œ ëª…ë‹¨ + ëŒ€ê¸° ëª…ë‹¨
  --------------------------------------------------- */
  #areaC {
    width: 320px;
    padding: 10px;
    border: 1px solid #aaa;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
  }

  .smallTable {
    width: 320px;
    border-collapse: collapse;
  }

  .smallTable th {
    background: #bae4ff;
    padding: 5px;
    border: 1px solid #999;
  }
  .smallTable td {
    height: 22px;
    padding: 5px;
    border: 1px solid #999;
    text-align: center;
  }

  .warningRow {
    background-color: #fff6a3 !important;
  }
</style>
</head>

<body>
<!-- ============================================================
     TOP AREA : ì˜¤ë”ëª… ì…ë ¥ + ì €ì¥ ë²„íŠ¼
============================================================ -->
<div id="topArea">
  <h1>ì˜¤ë” ì‘ì„±</h1>

  <div style="margin-top: 10px;">
    <label>ì˜¤ë”ëª…: </label>
    <input type="text" id="orderName" placeholder="ì˜ˆ: 4ì›” 28ì¼ LGì „"
           style="width: 260px; padding: 6px;" />
  </div>

  <button class="buttonStyles" style="margin-top: 15px;" onclick="saveOrder()">
    ğŸ’¾ ì €ì¥ (ì¶”í›„ êµ¬í˜„)
  </button>
</div>


<!-- ============================================================
     MAIN AREA : A / B / C 3ë‹¨ ë ˆì´ì•„ì›ƒ
============================================================ -->
<div id="mainArea">

  <!-- ============================================================
       A AREA : ì°¸ê°€ ì„ ìˆ˜ ëª…ë‹¨ (ì™¼ìª½)
  ============================================================ -->
  <div id="areaA">
    <h3>ì°¸ê°€ ëª…ë‹¨</h3>

    <div style="display:flex; gap:10px; align-items:center; margin-bottom:10px;">
      <select id="playerSelect"></select>
      <button class="buttonStyles" onclick="addPlayer()">ì¶”ê°€</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>ì„ ìˆ˜ëª…</th>
          <th>ë°°ë²ˆ</th>
          <th>ì‚­ì œ</th>
        </tr>
      </thead>
      <tbody id="playerTableBody"></tbody>
    </table>
  </div>


  <!-- ============================================================
       B AREA : í¬ì§€ì…˜ ì˜ì—­(ìœ„) + ì¶œì „ ê°€ëŠ¥ í¬ì§€ì…˜ ë¦¬ìŠ¤íŠ¸(ì•„ë˜)
  ============================================================ -->
  <div id="areaB">

    <!-- ------------------ B1 : í¬ì§€ì…˜ ì§€ì • ------------------ -->
    <div id="areaB1" style="align-self: center;">

      <!-- ì™¸ì•¼ -->
      <select id="pos_CF" class="posSelect" onchange="updatePosition('CF', this.value)"></select>
      <select id="pos_LF" class="posSelect" onchange="updatePosition('LF', this.value)"></select>
      <select id="pos_RF" class="posSelect" onchange="updatePosition('RF', this.value)"></select>

      <!-- ë‚´ì•¼ -->
      <select id="pos_SS" class="posSelect" onchange="updatePosition('SS', this.value)"></select>
      <select id="pos_2B" class="posSelect" onchange="updatePosition('2B', this.value)"></select>
      <select id="pos_3B" class="posSelect" onchange="updatePosition('3B', this.value)"></select>
      <select id="pos_1B" class="posSelect" onchange="updatePosition('1B', this.value)"></select>

      <!-- ë°°í„°ë¦¬ & DH -->
      <select id="pos_P"  class="posSelect" onchange="updatePosition('P',  this.value)"></select>
      <select id="pos_C"  class="posSelect" onchange="updatePosition('C',  this.value)"></select>
      <select id="pos_DH" class="posSelect" onchange="updatePosition('DH', this.value)"></select>

    </div>

    <!-- ------------------ B2 : ì¶œì „ ê°€ëŠ¥ í¬ì§€ì…˜ ë¦¬ìŠ¤íŠ¸ ------------------ -->
    <div id="areaB2">
      <h3>ì¶œì „ ê°€ëŠ¥ í¬ì§€ì…˜ ë¦¬ìŠ¤íŠ¸</h3>
      <!-- ì§€ê¸ˆì€ ë¹„ì›Œë‘  (ì¶”í›„ ê¸°ëŠ¥ ì¶”ê°€ ì˜ˆì •) -->
      <div style="color:#777; font-size:14px; margin-top:5px;">
        (ì¶”í›„ ê¸°ëŠ¥ ì¶”ê°€ ì˜ˆì •)
      </div>
    </div>

  </div>


  <!-- ============================================================
       C AREA : ì„ ë°œ ëª…ë‹¨ + ëŒ€ê¸° ëª…ë‹¨
  ============================================================ -->
  <div id="areaC">

    <!-- ------------------ ì„ ë°œ ëª…ë‹¨ ------------------ -->
    <div id="areaC1">
      <table class="smallTable">
        <caption style="font-weight: bolder;">ì„ ë°œ ëª…ë‹¨</caption>
        <thead>
          <tr>
            <th>íƒ€ìˆœ</th>
            <th>ì„ ìˆ˜ëª…</th>
            <th>ë°°ë²ˆ</th>
            <th>í¬ì§€ì…˜</th>
          </tr>
        </thead>
        <tbody id="startingTableBody"></tbody>
      </table>
    </div>

    <!-- ------------------ ëŒ€ê¸° ëª…ë‹¨ ------------------ -->
    <div id="areaC2">
      <table class="smallTable">
                <caption style="font-weight: bolder;">ëŒ€ê¸° ëª…ë‹¨</caption>
        <thead>
          <tr>
            <th>ì„ ìˆ˜ëª…</th>
            <th>ë°°ë²ˆ</th>
          </tr>
        </thead>
        <tbody id="waitingTableBody"></tbody>
      </table>
    </div>

  </div>

</div> <!-- END OF MAIN AREA -->
<script>
/* ============================================================
   API ENDPOINTS
============================================================ */
const API = {
  getPlayers: "https://getplayers-2guymqucma-uc.a.run.app"
};


/* ============================================================
   GLOBAL DATA STRUCTURES
============================================================ */

/* ì „ì²´ ì„ ìˆ˜ DB */
let playerDB = [];

/* ì™¼ìª½ ì°¸ê°€ ì„ ìˆ˜ ëª…ë‹¨ */
let selectedPlayers = [];

/* í¬ì§€ì…˜ í• ë‹¹ ì •ë³´ (ì•¼êµ¬ì¥) */
let positionAssignments = {
  CF:"", LF:"", RF:"",
  SS:"", "2B":"", "3B":"",
  P:"", C:"", DH:"", "1B":""
};

/* ì„ ë°œ ëª…ë‹¨ (1~9 + P) â€” ì´ 10í–‰ */
let startingList = Array(10).fill("").map(() => ({
  name: "",
  num: "",
  pos: ""
}));


/* ============================================================
   INITIAL STARTUP
============================================================ */
window.onload = async () => {
  await loadPlayerDB();
  setupStartingTable();
  renderPlayerSelect();
  renderPlayerTable();
  renderPositionSelects();
  renderStartingTable();
  renderWaitingTable();
};


/* ============================================================
   1) ì„ ìˆ˜ DB ë¶ˆëŸ¬ì˜¤ê¸°
============================================================ */
async function loadPlayerDB() {
  const res = await fetch(API.getPlayers);
  playerDB = await res.json();
}


/* ============================================================
   2) ì°¸ê°€ ì„ ìˆ˜ ì¶”ê°€ select ë Œë”ë§
============================================================ */
function renderPlayerSelect() {
  const select = document.getElementById("playerSelect");
  select.innerHTML = "";

  const candidates = playerDB.filter(p => !selectedPlayers.includes(p.name));

  if (candidates.length === 0) {
    const opt = document.createElement("option");
    opt.textContent = "ì¶”ê°€ ì—†ìŒ";
    opt.disabled = true;
    select.appendChild(opt);
    return;
  }

  candidates.forEach(p => {
    const opt = document.createElement("option");
    opt.value = p.name;
    opt.textContent = `${p.name} (${p.num})`;
    select.appendChild(opt);
  });
}


/* ============================================================
   3) ì°¸ê°€ ì„ ìˆ˜ í…Œì´ë¸” ë Œë”ë§
============================================================ */
function renderPlayerTable() {
  const tbody = document.getElementById("playerTableBody");
  tbody.innerHTML = "";

  selectedPlayers.sort((a,b)=>a.localeCompare(b,"ko"));

  selectedPlayers.forEach(name => {
    const info = playerDB.find(x => x.name === name);

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${name}</td>
      <td>${info.num}</td>
      <td>
        <button class="buttonStyles" onclick="removePlayer('${name}')">
          ì‚­ì œ
        </button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}


/* ============================================================
   4) ì°¸ê°€ ì„ ìˆ˜ ì¶”ê°€
============================================================ */
function addPlayer() {
  const name = document.getElementById("playerSelect").value;
  if (!name) return;

  selectedPlayers.push(name);

  renderPlayerSelect();
  renderPlayerTable();
  renderPositionSelects();
  renderStartingTable();
  renderWaitingTable();
}


/* ============================================================
   5) ì°¸ê°€ ì„ ìˆ˜ ì‚­ì œ
============================================================ */
function removePlayer(name) {
  selectedPlayers = selectedPlayers.filter(n => n !== name);

  /* í¬ì§€ì…˜ì—ì„œ ì œê±° */
  for (const pos in positionAssignments) {
    if (positionAssignments[pos] === name) {
      positionAssignments[pos] = "";
    }
  }

  /* ì„ ë°œ ëª…ë‹¨ì—ì„œë„ ì œê±° */
  startingList.forEach((row, i) => {
    if (row.name === name) startingList[i] = { name:"", num:"", pos:"" };
  });

  renderPlayerSelect();
  renderPlayerTable();
  renderPositionSelects();
  renderStartingTable();
  renderWaitingTable();
}
/* ============================================================
   6) í¬ì§€ì…˜ select ë Œë”ë§ (ì•¼êµ¬ì¥ ìœ„ì˜ ë“œë¡­ë‹¤ìš´)
============================================================ */
function renderPositionSelects() {
  const selects = document.querySelectorAll(".posSelect");

  selects.forEach(sel => {
    const pos = sel.id.replace("pos_", "");
    sel.innerHTML = "";

    /* (0) ê³µë°± ì˜µì…˜ */
    const blank = document.createElement("option");
    blank.value = "";
    blank.textContent = " ";
    sel.appendChild(blank);

    /* (1) ì°¸ê°€ ì„ ìˆ˜ë§Œ ì„ íƒ ê°€ëŠ¥ */
    selectedPlayers.forEach(name => {
      const opt = document.createElement("option");
      opt.value = name;
      opt.textContent = name;

      if (positionAssignments[pos] === name) opt.selected = true;

      sel.appendChild(opt);
    });
  });
}


/* ============================================================
   7) í¬ì§€ì…˜ ë³€ê²½ ì‹œ ì „ì²´ ì‹œìŠ¤í…œê³¼ ìë™ ë™ê¸°í™”
============================================================ */
function updatePosition(pos, playerName) {

  // (A) ì¤‘ë³µ í¬ì§€ì…˜ ì œê±°
  for (const key in positionAssignments) {
    if (positionAssignments[key] === playerName) {
      positionAssignments[key] = "";
    }
  }

  // (B) ì´ í¬ì§€ì…˜ì— ìƒˆë¡œ ë°°ì •
  positionAssignments[pos] = playerName;

  // (C) í¬ì§€ì…˜ ì§€ì›Œì§„ ì„ ìˆ˜ëŠ” ì„ ë°œëª…ë‹¨ì—ì„œë„ ì œê±°
  startingList.forEach((row, i) => {
    if (!row.name) return;

    const stillAssigned = Object.values(positionAssignments).includes(row.name);
    if (!stillAssigned) {
      startingList[i] = { name:"", num:"", pos:"" };
    }
  });

  // (D) í¬ì§€ì…˜ì´ ë°”ë€ ì„ ìˆ˜ì˜ ì„ ë°œëª…ë‹¨ í¬ì§€ì…˜ë„ ê°±ì‹ 
  startingList.forEach((row, i) => {
    if (!row.name) return;

    const currentPosCode = Object.keys(positionAssignments)
      .find(key => positionAssignments[key] === row.name);

    if (currentPosCode) {
      row.pos = convertPosition(currentPosCode);
    } else {
      startingList[i] = { name:"", num:"", pos:"" };
    }
  });

  renderPositionSelects();
  renderStartingTable();
  renderWaitingTable();
}



/* ============================================================
   8) ì„ ë°œ ê°€ëŠ¥ ì„ ìˆ˜ = í¬ì§€ì…˜ì´ ì§€ì •ëœ ì„ ìˆ˜ë“¤ë§Œ
============================================================ */
function getStartingCandidates() {
  return Object.values(positionAssignments).filter(v => v !== "");
}
/* ============================================================
   9) ì„ ë°œ ëª…ë‹¨ í…Œì´ë¸” ê¸°ë³¸ í–‰ êµ¬ì„± (1~9 + íˆ¬ìˆ˜)
============================================================ */
function setupStartingTable() {
  const tbody = document.getElementById("startingTableBody");
  tbody.innerHTML = "";

  for (let i = 0; i < 10; i++) {
    const orderLabel = (i < 9) ? (i + 1) : "íˆ¬ìˆ˜";

    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${orderLabel}</td>

      <td>
        ${
          i === 9
          ? `<span id="start_name_${i}"></span>`
          : `<select id="start_sel_${i}" style="width:70px" onchange="selectStarting(${i}, this.value)"></select>`
        }
      </td>

      <td id="start_num_${i}" style="width:70px"></td>
      <td id="start_pos_${i}" style="width:100px"></td>
    `;

    tbody.appendChild(tr);
  }
}


/* ============================================================
   10) ì„ ë°œ ëª…ë‹¨ í…Œì´ë¸” ë Œë”ë§
============================================================ */
function renderStartingTable() {

  const candidates = getStartingCandidates();

  for (let i = 0; i < 10; i++) {

    /* --- (1) íˆ¬ìˆ˜ ë¼ì¸ (ìë™ ì…ë ¥) --- */
    if (i === 9) {
      const pName = positionAssignments["P"];
      const nameSpan = document.getElementById("start_name_" + i);

      if (pName) {
        const p = playerDB.find(x => x.name === pName);
        nameSpan.textContent = pName;
        document.getElementById("start_num_" + i).textContent = p.num;
        document.getElementById("start_pos_" + i).textContent = convertPosition("P");

        startingList[i] = {
          name: pName,
          num: p.num,
          pos: convertPosition("P")
        };

      } else {
        nameSpan.textContent = "";
        document.getElementById("start_num_" + i).textContent = "";
        document.getElementById("start_pos_" + i).textContent = "";
        startingList[i] = { name:"", num:"", pos:"" };
      }

      continue;
    }


    /* --- (2) 1~9ë²ˆ íƒ€ì select ëª©ë¡ êµ¬ì„± --- */
    const sel = document.getElementById("start_sel_" + i);
    sel.innerHTML = "";

    const blank = document.createElement("option");
    blank.value = "";
    blank.textContent = " ";
    sel.appendChild(blank);

    candidates.forEach(name => {
      const opt = document.createElement("option");
      opt.value = name;
      opt.textContent = name;

      if (startingList[i].name === name) opt.selected = true;

      sel.appendChild(opt);
    });


    /* --- (3) ë°°ë²ˆ + í¬ì§€ì…˜ í‘œì‹œ --- */
    const row = startingList[i];

    if (row.name) {
      const p = playerDB.find(x => x.name === row.name);
      document.getElementById("start_num_" + i).textContent = p.num;
      document.getElementById("start_pos_" + i).textContent = row.pos;
    } else {
      document.getElementById("start_num_" + i).textContent = "";
      document.getElementById("start_pos_" + i).textContent = "";
    }
  }
}


/* ============================================================
   11) ì„ ë°œ íƒ€ìˆœ ì„ íƒ ì‹œ ì¤‘ë³µ ì œê±° + ë°ì´í„° ê°±ì‹ 
============================================================ */
function selectStarting(idx, playerName) {

  /* (A) ë‹¤ë¥¸ íƒ€ìˆœì— ê°™ì€ ì„ ìˆ˜ê°€ ìˆìœ¼ë©´ ì œê±° */
  startingList.forEach((row, i) => {
    if (i !== idx && row.name === playerName) {
      startingList[i] = { name:"", num:"", pos:"" };
    }
  });

  /* (B) í˜„ì¬ íƒ€ìˆœ ê°’ ê°±ì‹  */
  if (!playerName) {
    startingList[idx] = { name:"", num:"", pos:"" };
  } else {
    const p = playerDB.find(x => x.name === playerName);

    /* í•´ë‹¹ ì„ ìˆ˜ê°€ ì–´ë–¤ í¬ì§€ì…˜ì¸ì§€ ê³„ì‚° */
    const posCode = Object.keys(positionAssignments)
      .find(key => positionAssignments[key] === playerName);

    startingList[idx] = {
      name: playerName,
      num: p.num,
      pos: convertPosition(posCode)
    };
  }

  renderStartingTable();
  renderWaitingTable();
}


/* ============================================================
   12) í¬ì§€ì…˜ ì½”ë“œ â†’ í•œê¸€ í¬ì§€ì…˜ëª… ë³€í™˜
============================================================ */
function convertPosition(code) {
  const map = {
    CF: "ì¤‘ê²¬ìˆ˜(CF)",
    LF: "ì¢Œìµìˆ˜(LF)",
    RF: "ìš°ìµìˆ˜(RF)",
    SS: "ìœ ê²©ìˆ˜(SS)",
    "2B": "2ë£¨ìˆ˜(2B)",
    "3B": "3ë£¨ìˆ˜(3B)",
    "1B": "1ë£¨ìˆ˜(1B)",
    P:  "íˆ¬ìˆ˜(P)",
    C:  "í¬ìˆ˜(C)",
    DH: "ì§€ëª…íƒ€ì(DH)"
  };
  return map[code] || "";
}


/* ============================================================
   13) ëŒ€ê¸° ëª…ë‹¨ ë Œë”ë§
============================================================ */
function renderWaitingTable() {
  const tbody = document.getElementById("waitingTableBody");
  tbody.innerHTML = "";

  const starters = startingList
    .map(r => r.name)
    .filter(v => v);

  /* ì°¸ê°€ ì„ ìˆ˜ ì¤‘ ì„ ë°œ ëª…ë‹¨ì— ì—†ëŠ” ì„ ìˆ˜ */
  selectedPlayers
    .filter(name => !starters.includes(name))
    .sort((a,b)=>a.localeCompare(b,"ko"))
    .forEach(name => {

      const info = playerDB.find(x => x.name === name);
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${name}</td>
        <td>${info.num}</td>
      `;

      /* í¬ì§€ì…˜ì€ ìˆì§€ë§Œ ì„ ë°œì—” ì—†ëŠ” ì„ ìˆ˜ â†’ ë…¸ë€ìƒ‰ */
      const hasPosition = Object.values(positionAssignments).includes(name);
      if (hasPosition) tr.classList.add("warningRow");

      tbody.appendChild(tr);
    });
}
/* ============================================================
   14) ì €ì¥ ê¸°ëŠ¥ (ì¶”í›„ êµ¬í˜„)
============================================================ */
function saveOrder() {
  const name = document.getElementById("orderName").value.trim();

  if (!name) {
    alert("ì˜¤ë”ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }

  // ì €ì¥ë  ë°ì´í„° êµ¬ì¡° ì˜ˆì‹œ
  const payload = {
    orderName: name,
    players: [...selectedPlayers],
    positionAssignments: { ...positionAssignments },
    startingList: [...startingList]
  };

  console.log("ì €ì¥ ì˜ˆì • ë°ì´í„°:", payload);

  // ì‹¤ì œ ì €ì¥ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„
  alert("ì €ì¥ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ë©ë‹ˆë‹¤!");
}


/* ============================================================
   END OF SCRIPT
============================================================ */
</script>
</body>
</html>
