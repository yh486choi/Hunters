<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì˜¤ë” ì‘ì„±</title>

  <link rel="stylesheet" href="buttonStyles.css" />

  <style>
    body {
      font-size: 16px;
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    /* ---------------------------------------------------
        ìƒë‹¨ ì˜ì—­ (ì˜¤ë”ëª… + ë²„íŠ¼)
  --------------------------------------------------- */
    #topArea {
      margin-bottom: 25px;
      text-align: left;
    }

    #topArea h1 {
      margin-bottom: 10px;
    }

    /* ---------------------------------------------------
        ë©”ì¸ ë ˆì´ì•„ì›ƒ
        ì¢Œ: ì°¸ê°€ëª…ë‹¨ (areaA)
        ìš°: ì¤‘ì•™ ë¬¶ìŒ ë°•ìŠ¤(centerWrapper)
  --------------------------------------------------- */
    #mainArea {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }

    /* ì°¸ê°€ ëª…ë‹¨ (ì™¼ìª½ ë°•ìŠ¤) */
    #areaA {
      width: 180px;
      /* â† ì›í•˜ëŠ” ê°’ìœ¼ë¡œ ì¡°ì ˆ ê°€ëŠ¥ */
      flex-shrink: 0;
      border: 1px solid #aaa;
      border-radius: 8px;
      padding: 10px;
    }

    /* ---------------------------------------------------
        ì¤‘ì•™ ë¬¶ìŒ ë°•ìŠ¤: width = 1020px
  --------------------------------------------------- */
    #centerWrapper {
      width: 1020px;
      /* â† ë„¤ê°€ ì„ íƒí•œ ê¸°ë³¸ê°’ */
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* ---------------------------------------------------
        ì¤‘ì•™ ë¬¶ìŒ ë°•ìŠ¤(ìœ„): í¬ì§€ì…˜ + ì„ ë°œ + ëŒ€ê¸°
        ê°€ë¡œ 3ê°œ ë°•ìŠ¤ ë³‘ë ¬ ë°°ì¹˜
  --------------------------------------------------- */
    #positionAndStarterWrapper {
      display: flex;
      gap: 15px;
      width: 100%;
    }

    /* í¬ì§€ì…˜ ì§€ì • ë°•ìŠ¤ */
    #areaB1 {
      width: 550px;
      /* â† ë„ˆê°€ ì‰½ê²Œ ì¡°ì ˆ ê°€ëŠ¥ */
      height: 440px;
      background-image: url("field.png");
      background-size: cover;
      background-repeat: no-repeat;
      border: 1px solid #ccc;
      border-radius: 8px;
      position: relative;
      flex-shrink: 0;
    }

    /* í¬ì§€ì…˜ dropdown */
    .posSelect {
      position: absolute;
      width: 70px;
      padding: 3px;
      font-size: 14px;
      border-radius: 8px;
    }

    /* í¬ì§€ì…˜ ì¢Œí‘œ â€” (ë„¤ê°€ ë‚˜ì¤‘ì— ìˆ˜ì • ê°€ëŠ¥) */
    #pos_CF {
      top: 15%;
      left: 50%;
      transform: translateX(-50%);
    }

    #pos_LF {
      top: 25%;
      left: 18%;
    }

    #pos_RF {
      top: 25%;
      right: 18%;
    }

    #pos_SS {
      top: 47%;
      left: 30%;
    }

    #pos_2B {
      top: 47%;
      right: 30%;
    }

    #pos_3B {
      top: 63%;
      left: 20%;
    }

    #pos_1B {
      top: 63%;
      right: 20%;
    }

    #pos_P {
      top: 63%;
      left: 50%;
      transform: translateX(-50%);
    }

    #pos_C {
      top: 80%;
      left: 50%;
      transform: translateX(-50%);
    }

    #pos_DH {
      top: 85%;
      right: 13%;
    }

    /* ---------------------------------------------------
        ì„ ë°œ ëª…ë‹¨ (ê°€ìš´ë° ë°•ìŠ¤)
  --------------------------------------------------- */
    #areaC1 {
      width: 700px;
      border: 1px solid #aaa;
      border-radius: 8px;
      padding: 10px;
    }

    /* ---------------------------------------------------
        ëŒ€ê¸° ëª…ë‹¨ (ì˜¤ë¥¸ìª½ ë°•ìŠ¤)
  --------------------------------------------------- */
    #areaC2 {
      width: 300px;
      border: 1px solid #aaa;
      border-radius: 8px;
      padding: 10px;
    }

    /* ìµœê·¼ì— ë§Œë“  ì¶œì „ ê°€ëŠ¥ í¬ì§€ì…˜ ë¦¬ìŠ¤íŠ¸ */
    #areaB2 {
      width: 100%;
      /* centerWrapper ê¸°ì¤€ */
      border: 1px solid #aaa;
      border-radius: 8px;
      padding: 10px;
    }

    /* B2 ë‚´ë¶€: í¬ì§€ì…˜ë³„ ëŠ¥ë ¥ í…Œì´ë¸” ê°€ë¡œ ìŠ¤í¬ë¡¤ */
    #positionAbilityContainer {
      display: flex;
      gap: 12px;
      overflow-x: auto;
    }

    /* ê³µí†µ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 8px;
      height: max-content;
    }

    th,
    td {
      border: 1px solid #999;
      padding: 6px;
      text-align: center;
      height: 22px;
    }

    th {
      background: #bae4ff;
    }

    /* ìƒ‰ìƒ í‘œì‹œ (í¬ì§€ì…˜/ì„ ë°œ ê°€ëŠ¥ ë¦¬ìŠ¤íŠ¸ìš©) */
    .position-selected {
      background-color: #fff7a0 !important;
      /* ë…¸ë€ìƒ‰ */
    }

    .position-locked {
      background-color: #e2e2e2 !important;
      /* íšŒìƒ‰ */
    }

    .warningRow {
      background-color: #fff7a0 !important;
    }
  </style>
</head>

<body>
  <!-- ============================================================
      ìƒë‹¨ ì˜ì—­ (ì˜¤ë”ëª… + ì €ì¥ ë²„íŠ¼ ë“±)
============================================================ -->
  <div id="topArea">
    <h1>ì˜¤ë” ì‘ì„±</h1>

    <div style="margin-top: 10px;">
      <label>ì˜¤ë”ëª…: </label>
      <input type="text" id="orderName" placeholder="ì˜ˆ: 4ì›” 28ì¼ LGì „" style="width: 260px; padding: 6px;" />
    </div>

    <button class="buttonStyles" style="margin-top: 15px;" onclick="saveOrder()">
      ğŸ’¾ ì €ì¥ (ì¶”í›„ êµ¬í˜„)
    </button>
  </div>


  <!-- ============================================================
      ë©”ì¸ 2ë‹¨ ë ˆì´ì•„ì›ƒ
      ì™¼ìª½: ì°¸ê°€ ëª…ë‹¨ (areaA)
      ì˜¤ë¥¸ìª½: ì¤‘ì•™ ë¬¶ìŒ ë°•ìŠ¤(centerWrapper)
============================================================ -->
  <div id="mainArea">

    <!-- ---------------------------------------------------------
        A ì˜ì—­ â€” ì°¸ê°€ ì„ ìˆ˜ ëª…ë‹¨
  ---------------------------------------------------------- -->
    <div id="areaA">
      <h3>ì°¸ê°€ ëª…ë‹¨</h3>

      <div style="display:flex; gap:10px; align-items:center; margin-bottom:10px;">
        <select id="playerSelect"></select>
        <button class="buttonStyles" onclick="addPlayer()">ì¶”ê°€</button>
      </div>

      <table>
        <thead>
          <tr>
            <th>ì„ ìˆ˜ëª…</th>
            <th>ë°°ë²ˆ</th>
            <th>ì‚­ì œ</th>
          </tr>
        </thead>
        <tbody id="playerTableBody"></tbody>
      </table>
    </div>


    <!-- ---------------------------------------------------------
        ì¤‘ì•™ ë¬¶ìŒ ë°•ìŠ¤ ì „ì²´
        (í¬ì§€ì…˜ + ì„ ë°œ + ëŒ€ê¸° + ì¶œì „ê°€ëŠ¥í¬ì§€ì…˜)
  ---------------------------------------------------------- -->
    <div id="centerWrapper">

      <!-- -------------------------------------------------------
          ì¤‘ì•™ ë¬¶ìŒ ë‚´ë¶€ ìœ„ìª½ â€” í¬ì§€ì…˜ + ì„ ë°œ + ëŒ€ê¸°
    -------------------------------------------------------- -->
      <div id="positionAndStarterWrapper">

        <!-- B1: í¬ì§€ì…˜ ì§€ì • ì˜ì—­ -->
        <div id="areaB1">

          <!-- ì™¸ì•¼ -->
          <select id="pos_CF" class="posSelect" onchange="updatePosition('CF', this.value)"></select>
          <select id="pos_LF" class="posSelect" onchange="updatePosition('LF', this.value)"></select>
          <select id="pos_RF" class="posSelect" onchange="updatePosition('RF', this.value)"></select>

          <!-- ë‚´ì•¼ -->
          <select id="pos_SS" class="posSelect" onchange="updatePosition('SS', this.value)"></select>
          <select id="pos_2B" class="posSelect" onchange="updatePosition('2B', this.value)"></select>
          <select id="pos_3B" class="posSelect" onchange="updatePosition('3B', this.value)"></select>
          <select id="pos_1B" class="posSelect" onchange="updatePosition('1B', this.value)"></select>

          <!-- ë°°í„°ë¦¬ & DH -->
          <select id="pos_P" class="posSelect" onchange="updatePosition('P',  this.value)"></select>
          <select id="pos_C" class="posSelect" onchange="updatePosition('C',  this.value)"></select>
          <select id="pos_DH" class="posSelect" onchange="updatePosition('DH', this.value)"></select>

        </div>


        <!-- C1: ì„ ë°œ ëª…ë‹¨ -->
        <div id="areaC1">
          <table class="smallTable">
            <caption style="font-weight: bolder;">ì„ ë°œ ëª…ë‹¨</caption>
            <thead>
              <tr>
                <th style="width: 35px;">íƒ€ìˆœ</th>
                <th style="width: 70px;">ì„ ìˆ˜ëª…</th>
                <th style="width: 35px;">ë°°ë²ˆ</th>
                <th>í¬ì§€ì…˜</th>
              </tr>
            </thead>
            <tbody id="startingTableBody"></tbody>
          </table>
        </div>


        <!-- C2: ëŒ€ê¸° ëª…ë‹¨ -->
        <div id="areaC2">
          <table class="smallTable">
            <caption style="font-weight: bolder;">ëŒ€ê¸° ëª…ë‹¨</caption>
            <thead>
              <tr>
                <th style="width: 60px;">ì„ ìˆ˜ëª…</th>
                <th style="width: 35px;">ë°°ë²ˆ</th>
              </tr>
            </thead>
            <tbody id="waitingTableBody"></tbody>
          </table>
        </div>

      </div> <!-- positionAndStarterWrapper END -->


      <!-- -------------------------------------------------------
          ì¤‘ì•™ ë¬¶ìŒ í•˜ë‹¨ â€” ì¶œì „ ê°€ëŠ¥ í¬ì§€ì…˜ ë¦¬ìŠ¤íŠ¸(B2)
    -------------------------------------------------------- -->
      <div id="areaB2">
        <div id="positionAbilityContainer"></div>
      </div>

    </div> <!-- centerWrapper END -->

  </div> <!-- mainArea END -->
  <script>
    /* ============================================================
       API ENDPOINTS
    ============================================================ */
    const API = {
      getPlayers: "https://getplayers-2guymqucma-uc.a.run.app"
    };


    /* ============================================================
       GLOBAL DATA STRUCTURES
    ============================================================ */

    /* ì „ì²´ ì„ ìˆ˜ DB */
    let playerDB = [];

    /* ì°¸ê°€ ì„ ìˆ˜ ëª…ë‹¨ */
    let selectedPlayers = [];

    /* í¬ì§€ì…˜ í• ë‹¹ ì •ë³´ (ì•¼êµ¬ì¥ ë°°ì¹˜) */
    let positionAssignments = {
      CF: "", LF: "", RF: "",
      SS: "", "2B": "", "3B": "",
      P: "", C: "", DH: "", "1B": ""
    };

    /* ì„ ë°œ ëª…ë‹¨ (1~9 + íˆ¬ìˆ˜) */
    let startingList = Array(10).fill("").map(() => ({
      name: "",
      num: "",
      pos: ""
    }));

    /* ì¶œì „ ê°€ëŠ¥ í¬ì§€ì…˜ í…Œì´ë¸”ì— ì‚¬ìš©í•  í¬ì§€ì…˜ ëª©ë¡ */
    const abilityPositions = [
      { key: "p", label: "íˆ¬ìˆ˜(P)" },
      { key: "c", label: "í¬ìˆ˜(C)" },
      { key: "1b", label: "1ë£¨ìˆ˜(1B)" },
      { key: "2b", label: "2ë£¨ìˆ˜(2B)" },
      { key: "3b", label: "3ë£¨ìˆ˜(3B)" },
      { key: "ss", label: "ìœ ê²©ìˆ˜(SS)" },
      { key: "of", label: "ì™¸ì•¼ìˆ˜(OF)" }
    ];


    /* ============================================================
       INITIAL STARTUP
    ============================================================ */
    window.onload = async () => {
      await loadPlayerDB();

      setupStartingTable();
      renderPlayerSelect();
      renderPlayerTable();

      renderPositionSelects();
      renderStartingTable();
      renderWaitingTable();

      renderPositionAbility();   // ì¶œì „ ê°€ëŠ¥ í¬ì§€ì…˜ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
    };


    /* ============================================================
       1) ì„ ìˆ˜ DB ë¶ˆëŸ¬ì˜¤ê¸°
    ============================================================ */
    async function loadPlayerDB() {
      const res = await fetch(API.getPlayers);
      playerDB = await res.json();
    }


    /* ============================================================
       2) ì°¸ê°€ ì„ ìˆ˜ Select ë°•ìŠ¤ ë Œë”ë§
    ============================================================ */
    function renderPlayerSelect() {
      const select = document.getElementById("playerSelect");
      select.innerHTML = "";

      const candidates = playerDB.filter(p => !selectedPlayers.includes(p.name));

      if (candidates.length === 0) {
        const opt = document.createElement("option");
        opt.textContent = "ì¶”ê°€ ì—†ìŒ";
        opt.disabled = true;
        select.appendChild(opt);
        return;
      }

      candidates.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p.name;
        opt.textContent = `${p.name} (${p.num})`;
        select.appendChild(opt);
      });
    }


    /* ============================================================
       3) ì°¸ê°€ ì„ ìˆ˜ í…Œì´ë¸” ë Œë”ë§
    ============================================================ */
    function renderPlayerTable() {
      const tbody = document.getElementById("playerTableBody");
      tbody.innerHTML = "";

      selectedPlayers.sort((a, b) => a.localeCompare(b, "ko"));

      selectedPlayers.forEach(name => {
        const info = playerDB.find(x => x.name === name);

        const tr = document.createElement("tr");
        tr.innerHTML = `
      <td>${name}</td>
      <td>${info.num}</td>
      <td>
        <button class="buttonStyles" onclick="removePlayer('${name}')">
          ì‚­ì œ
        </button>
      </td>
    `;
        tbody.appendChild(tr);
      });
    }


    /* ============================================================
       4) ì°¸ê°€ ì„ ìˆ˜ ì¶”ê°€
    ============================================================ */
    function addPlayer() {
      const name = document.getElementById("playerSelect").value;
      if (!name) return;

      selectedPlayers.push(name);

      renderPlayerSelect();
      renderPlayerTable();
      renderPositionSelects();
      renderStartingTable();
      renderWaitingTable();
      renderPositionAbility();   // â˜… ì¶”ê°€
    }


    /* ============================================================
       5) ì°¸ê°€ ì„ ìˆ˜ ì‚­ì œ
    ============================================================ */
    function removePlayer(name) {
      selectedPlayers = selectedPlayers.filter(n => n !== name);

      /* í¬ì§€ì…˜ì—ì„œ ì œê±° */
      for (const pos in positionAssignments) {
        if (positionAssignments[pos] === name) {
          positionAssignments[pos] = "";
        }
      }

      /* ì„ ë°œ ëª…ë‹¨ì—ì„œë„ ì œê±° */
      startingList.forEach((row, i) => {
        if (row.name === name) {
          startingList[i] = { name: "", num: "", pos: "" };
        }
      });

      renderPlayerSelect();
      renderPlayerTable();
      renderPositionSelects();
      renderStartingTable();
      renderWaitingTable();
      renderPositionAbility();   // â˜… ì¶”ê°€
    }
    /* ============================================================
       6) í¬ì§€ì…˜ ì„ íƒë°•ìŠ¤ ë Œë”ë§ (ì•¼êµ¬ì¥ ìœ„ì˜ ë“œë¡­ë‹¤ìš´)
    ============================================================ */
    function renderPositionSelects() {
      const selects = document.querySelectorAll(".posSelect");

      selects.forEach(sel => {
        const pos = sel.id.replace("pos_", ""); // CF, SS, P ...

        sel.innerHTML = "";

        /* 0) ê³µë°± ì˜µì…˜ */
        const blank = document.createElement("option");
        blank.value = "";
        blank.textContent = " ";
        sel.appendChild(blank);

        /* 1) ì°¸ê°€ ì„ ìˆ˜ë§Œ ì„ íƒ ê°€ëŠ¥ */
        selectedPlayers.forEach(name => {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;

          if (positionAssignments[pos] === name) {
            opt.selected = true;
          }

          sel.appendChild(opt);
        });
      });
    }


    /* ============================================================
       7) í¬ì§€ì…˜ ë³€ê²½ ì²˜ë¦¬
    ============================================================ */
    function updatePosition(pos, playerName) {

      /* ------------------------------------------
          (A) ê°™ì€ ì„ ìˆ˜ê°€ ë‹¤ë¥¸ í¬ì§€ì…˜ì— ë°°ì •ë˜ì–´ ìˆìœ¼ë©´ ì œê±°
      ------------------------------------------- */
      for (const key in positionAssignments) {
        if (positionAssignments[key] === playerName) {
          positionAssignments[key] = "";
        }
      }

      /* í˜„ì¬ í¬ì§€ì…˜ì— ìƒˆ ì„ ìˆ˜ ë°°ì • */
      positionAssignments[pos] = playerName;

      /* ------------------------------------------
          (B) í¬ì§€ì…˜ì´ ì‚¬ë¼ì§„ ì„ ë°œëª…ë‹¨ì€ ìë™ ì œê±°
      ------------------------------------------- */
      startingList.forEach((row, i) => {
        if (!row.name) return;

        const stillAssigned = Object.values(positionAssignments).includes(row.name);
        if (!stillAssigned) {
          startingList[i] = { name: "", num: "", pos: "" };
        }
      });

      /* ------------------------------------------
          (C) í¬ì§€ì…˜ì´ ë°”ë€ ì„ ìˆ˜ì˜ ì„ ë°œëª…ë‹¨ í¬ì§€ì…˜ ê°±ì‹ 
      ------------------------------------------- */
      startingList.forEach((row, i) => {
        if (!row.name) return;

        const currentPosCode = Object.keys(positionAssignments)
          .find(key => positionAssignments[key] === row.name);

        if (currentPosCode) {
          row.pos = convertPosition(currentPosCode);
        } else {
          startingList[i] = { name: "", num: "", pos: "" };
        }
      });

      renderPositionSelects();
      renderStartingTable();
      renderWaitingTable();
      renderPositionAbility();   // â˜… ì¶œì „ ê°€ëŠ¥ í¬ì§€ì…˜ ë¦¬ìŠ¤íŠ¸ ì¦‰ì‹œ ê°±ì‹ 
    }


    /* ============================================================
       8) ì„ ë°œ í›„ë³´ = ì‹¤ì œ í¬ì§€ì…˜ì´ ë°°ì •ëœ ì„ ìˆ˜ë“¤
    ============================================================ */
    function getStartingCandidates() {
      return Object.values(positionAssignments).filter(v => v !== "");
    }
    /* ============================================================
       9) ì„ ë°œ ëª…ë‹¨ í…Œì´ë¸” ê¸°ë³¸ êµ¬ì¡° ìƒì„± (1~9 + íˆ¬ìˆ˜)
    ============================================================ */
    function setupStartingTable() {
      const tbody = document.getElementById("startingTableBody");
      tbody.innerHTML = "";

      for (let i = 0; i < 10; i++) {
        const orderLabel = (i < 9) ? (i + 1) : "íˆ¬ìˆ˜";

        const tr = document.createElement("tr");

        tr.innerHTML = `
      <td>${orderLabel}</td>

      <td>
        ${i === 9
            ? `<span id="start_name_${i}"></span>`
            : `<select id="start_sel_${i}" style="width:70px;" onchange="selectStarting(${i}, this.value)"></select>`
          }
      </td>

      <td id="start_num_${i}"></td>
      <td id="start_pos_${i}"></td>
    `;

        tbody.appendChild(tr);
      }
    }


    /* ============================================================
       10) ì„ ë°œ ëª…ë‹¨ ë Œë”ë§
    ============================================================ */
    function renderStartingTable() {

      const candidates = getStartingCandidates();

      for (let i = 0; i < 10; i++) {

        /* ------------------------------
             10ë²ˆí–‰ = íˆ¬ìˆ˜ ìë™ ì…ë ¥
        ------------------------------ */
        if (i === 9) {
          const pName = positionAssignments["P"];
          const nameSpan = document.getElementById("start_name_" + i);

          if (pName) {
            const p = playerDB.find(x => x.name === pName);
            nameSpan.textContent = pName;
            document.getElementById("start_num_" + i).textContent = p.num;
            document.getElementById("start_pos_" + i).textContent = convertPosition("P");

            startingList[i] = {
              name: pName,
              num: p.num,
              pos: convertPosition("P")
            };

          } else {
            nameSpan.textContent = "";
            document.getElementById("start_num_" + i).textContent = "";
            document.getElementById("start_pos_" + i).textContent = "";
            startingList[i] = { name: "", num: "", pos: "" };
          }

          continue;
        }


        /* ------------------------------
             1~9ë²ˆ íƒ€ì select ëª©ë¡ êµ¬ì„±
        ------------------------------ */
        const sel = document.getElementById("start_sel_" + i);
        sel.innerHTML = "";

        const blank = document.createElement("option");
        blank.value = "";
        blank.textContent = " ";
        sel.appendChild(blank);

        candidates.forEach(name => {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;

          if (startingList[i].name === name) opt.selected = true;

          sel.appendChild(opt);
        });


        /* ------------------------------
             ë°°ë²ˆ + í¬ì§€ì…˜ëª… í‘œì‹œ
        ------------------------------ */
        const row = startingList[i];

        if (row.name) {
          const p = playerDB.find(x => x.name === row.name);
          document.getElementById("start_num_" + i).textContent = p.num;
          document.getElementById("start_pos_" + i).textContent = row.pos;
        } else {
          document.getElementById("start_num_" + i).textContent = "";
          document.getElementById("start_pos_" + i).textContent = "";
        }
      }
    }


    /* ============================================================
       11) ì„ ë°œ íƒ€ìˆœ ì„ íƒ ì²˜ë¦¬ (ì¤‘ë³µ ìë™ ì œê±°)
    ============================================================ */
    function selectStarting(idx, playerName) {

      /* (A) ë‹¤ë¥¸ íƒ€ìˆœì— ê¸°ì¡´ ê°’ ìˆìœ¼ë©´ ì œê±° */
      startingList.forEach((row, i) => {
        if (i !== idx && row.name === playerName) {
          startingList[i] = { name: "", num: "", pos: "" };
        }
      });

      /* (B) í˜„ì¬ í–‰ ì—…ë°ì´íŠ¸ */
      if (!playerName) {
        startingList[idx] = { name: "", num: "", pos: "" };
      } else {
        const p = playerDB.find(x => x.name === playerName);

        // í˜„ì¬ ë°°ì •ëœ í¬ì§€ì…˜ ì°¾ê¸°
        const posCode = Object.keys(positionAssignments)
          .find(key => positionAssignments[key] === playerName);

        startingList[idx] = {
          name: playerName,
          num: p.num,
          pos: convertPosition(posCode)
        };
      }

      renderStartingTable();
      renderWaitingTable();
      renderPositionAbility();  // â˜… ì¶œì „ ê°€ëŠ¥ í¬ì§€ì…˜ ë¦¬ìŠ¤íŠ¸ ì‹¤ì‹œê°„ ê°±ì‹ 
    }


    /* ============================================================
       12) í¬ì§€ì…˜ ì½”ë“œ â†’ í•œê¸€ í¬ì§€ì…˜ëª… ë³€í™˜
    ============================================================ */
    function convertPosition(code) {
      const map = {
        CF: "ì¤‘ê²¬ìˆ˜(CF)",
        LF: "ì¢Œìµìˆ˜(LF)",
        RF: "ìš°ìµìˆ˜(RF)",
        SS: "ìœ ê²©ìˆ˜(SS)",
        "2B": "2ë£¨ìˆ˜(2B)",
        "3B": "3ë£¨ìˆ˜(3B)",
        "1B": "1ë£¨ìˆ˜(1B)",
        P: "íˆ¬ìˆ˜(P)",
        C: "í¬ìˆ˜(C)",
        DH: "ì§€ëª…íƒ€ì(DH)"
      };
      return map[code] || "";
    }


    /* ============================================================
       13) ëŒ€ê¸° ëª…ë‹¨ ë Œë”ë§
    ============================================================ */
    function renderWaitingTable() {
      const tbody = document.getElementById("waitingTableBody");
      tbody.innerHTML = "";

      const starters = startingList
        .map(r => r.name)
        .filter(v => v);

      selectedPlayers
        .filter(name => !starters.includes(name))
        .sort((a, b) => a.localeCompare(b, "ko"))
        .forEach(name => {

          const info = playerDB.find(x => x.name === name);
          const tr = document.createElement("tr");

          tr.innerHTML = `
        <td>${name}</td>
        <td>${info.num}</td>
      `;

          const hasPosition = Object.values(positionAssignments).includes(name);
          if (hasPosition) tr.classList.add("warningRow");

          tbody.appendChild(tr);
        });
    }
    /* ============================================================
       14) ì¶œì „ ê°€ëŠ¥ í¬ì§€ì…˜ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
    ============================================================ */
    function renderPositionAbility() {
      const container = document.getElementById("positionAbilityContainer");
      container.innerHTML = "";

      abilityPositions.forEach(pos => {

        let starters = [];
        let backups = [];

        /* -------------------------------------------------------
              ì°¸ê°€ ëª…ë‹¨ ì„ ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ì„ ë°œ/í›„ë³´ ë¶„ë¥˜
        -------------------------------------------------------- */
        selectedPlayers.forEach(name => {
          const player = playerDB.find(x => x.name === name);
          if (!player) return;

          const val = Number(player[pos.key]);   // 0 / 1 / 2

          if (val === 2) starters.push(name);
          else if (val === 1) backups.push(name);
        });

        starters.sort((a, b) => a.localeCompare(b, "ko"));
        backups.sort((a, b) => a.localeCompare(b, "ko"));

        /* -------------------------------------------------------
              í…Œì´ë¸” ìƒì„±
        -------------------------------------------------------- */
        const table = document.createElement("table");
        table.classList.add("smallTable");

        /* ì²« í–‰: í¬ì§€ì…˜ëª… (2ì¹¸ ë³‘í•©) */
        const trTitle = document.createElement("tr");
        const thTitle = document.createElement("th");
        thTitle.colSpan = 2;
        thTitle.textContent = pos.label;
        trTitle.appendChild(thTitle);
        table.appendChild(trTitle);

        /* ë‘ ë²ˆì§¸ í–‰: 'ì„ ë°œ' / 'í›„ë³´' */
        const trHeader = document.createElement("tr");
        trHeader.innerHTML = `
      <th>ì„ ë°œ</th>
      <th>í›„ë³´</th>
    `;
        table.appendChild(trHeader);

        /* í–‰ ìˆ˜ = ì„ ë°œ/í›„ë³´ ì¤‘ ë” ê¸´ ë¦¬ìŠ¤íŠ¸ */
        const maxLen = Math.max(starters.length, backups.length);

        for (let i = 0; i < maxLen; i++) {
          const tr = document.createElement("tr");

          const starterName = starters[i] || "";
          const backupName = backups[i] || "";

          const tdStarter = document.createElement("td");
          const tdBackup = document.createElement("td");

          tdStarter.textContent = starterName;
          tdBackup.textContent = backupName;

          /* -------------------------------------------------------
                ìƒ‰ìƒ ì²˜ë¦¬ ë¡œì§
                - ì‹¤ì œ í•´ë‹¹ í¬ì§€ì…˜ì— ë°°ì •ë˜ë©´ ë…¸ë€ìƒ‰
                - ë‹¤ë¥¸ í¬ì§€ì…˜ ë°°ì •ì´ë©´ íšŒìƒ‰
          -------------------------------------------------------- */
          /* í¬ì§€ì…˜ í‚¤ ë§¤ì¹­ (OF: CF/LF/RF í¬í•¨) */
          function isSamePosition(posKey, assignedPos) {
            if (!assignedPos) return false;

            // ì™¸ì•¼ í†µí•© ì²˜ë¦¬
            if (posKey === "of") {
              return ["cf", "lf", "rf"].includes(assignedPos.toLowerCase());
            }

            return assignedPos.toLowerCase() === posKey;
          }

          /* ìƒ‰ìƒ ì²˜ë¦¬ ë°©ì‹ */
          if (starterName) {
            const assignedPos = Object.keys(positionAssignments)
              .find(key => positionAssignments[key] === starterName);

            if (assignedPos) {
              if (isSamePosition(pos.key, assignedPos)) {
                tdStarter.classList.add("position-selected"); // ë…¸ë€ìƒ‰
              } else {
                tdStarter.classList.add("position-locked");   // íšŒìƒ‰
              }
            }
          }

          if (backupName) {
            const assignedPos = Object.keys(positionAssignments)
              .find(key => positionAssignments[key] === backupName);

            if (assignedPos) {
              if (isSamePosition(pos.key, assignedPos)) {
                tdBackup.classList.add("position-selected"); // ë…¸ë€ìƒ‰
              } else {
                tdBackup.classList.add("position-locked");   // íšŒìƒ‰
              }
            }
          }


          tr.appendChild(tdStarter);
          tr.appendChild(tdBackup);
          table.appendChild(tr);
        }

        container.appendChild(table);
      });
    }
    /* ============================================================
       15) ì €ì¥ ê¸°ëŠ¥ (ì¶”í›„ ì‹¤ì œ ì €ì¥ êµ¬í˜„ ì˜ˆì •)
    ============================================================ */
    function saveOrder() {
      const name = document.getElementById("orderName").value.trim();

      if (!name) {
        alert("ì˜¤ë”ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      // ì €ì¥ë  ì „ì²´ ë°ì´í„° êµ¬ì¡°
      const payload = {
        orderName: name,
        players: [...selectedPlayers],
        positions: { ...positionAssignments },
        startingList: [...startingList]
      };

      console.log("ì €ì¥ ì˜ˆì • ë°ì´í„°:", payload);

      alert("ì €ì¥ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ë©ë‹ˆë‹¤!");
    }

  </script>

</body>

</html>